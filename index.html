<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MUC Hospital System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --primary:#480D08;
  --secondary:#7a1f18;
  --bg:#f5f3f3;
  --white:#ffffff;
  --success:#2ecc71;
  --warning:#f1c40f;
  --danger:#e74c3c;
}

*{
  box-sizing:border-box;
  font-family:'Segoe UI', Tahoma, sans-serif;
}

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#3a0705,#6b1a14);
  display:flex;
  flex-direction:column;
}

/* ===== Header ===== */
header{
  background:rgba(0,0,0,.25);
  padding:18px 40px;
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h2{margin:0}

header button{
  margin-left:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,.6);
  color:white;
  padding:8px 18px;
  border-radius:20px;
  cursor:pointer;
  transition:.3s;
}

header button:hover{
  background:white;
  color:var(--primary);
}

/* ===== Layout ===== */
.main{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

/* ===== Card ===== */
.card{
  background:white;
  width:380px;
  padding:35px 30px;
  border-radius:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.3);
  animation:fadeUp .6s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(25px)}
  to{opacity:1;transform:translateY(0)}
}

.card h3{
  text-align:center;
  color:var(--primary);
  margin-bottom:25px;
}

/* ===== Inputs ===== */
input,select{
  width:100%;
  padding:12px 15px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}

input:focus,select:focus{
  outline:none;
  border-color:var(--primary);
}

/* ===== Buttons ===== */
.primary-btn{
  width:100%;
  padding:12px;
  border:none;
  border-radius:25px;
  background:linear-gradient(135deg,#480D08,#7a1f18);
  color:white;
  font-size:16px;
  cursor:pointer;
  transition:.3s;
}

.primary-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

.hidden{display:none}

/* ===== Dashboard ===== */
.dashboard{
  max-width:900px;
  width:100%;
  background:white;
  border-radius:20px;
  padding:30px;
  box-shadow:0 25px 50px rgba(0,0,0,.3);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}

.box{
  background:#f8f6f6;
  padding:20px;
  border-radius:15px;
  cursor:pointer;
  transition:.3s;
  text-align:center;
}

.box:hover{transform:translateY(-5px)}

.badge{
  display:inline-block;
  padding:5px 12px;
  border-radius:20px;
  font-size:13px;
  margin-top:8px;
  color:white;
}

.pending{background:var(--warning);color:black}
.approved{background:var(--success)}
.rejected{background:var(--danger)}
</style>
</head>

<body>

<header>
  <h2>MUC Hospital</h2>

  <!-- ŸÇÿ®ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
  <div id="navAuth">
    <button onclick="showLogin()">Login</button>
    <button onclick="showRegister()">Sign Up</button>
  </div>

  <!-- ÿ®ÿπÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
  <div id="navLogout" class="hidden">
    <button onclick="logout()">Logout</button>
  </div>
</header>

<div class="main">

<!-- Login -->
<div id="loginBox" class="card">
  <h3>Login</h3>
  <form id="loginForm">
    <input id="loginEmail" type="email" placeholder="üìß Email" required>
    <input id="loginPassword" type="password" placeholder="üîí Password" required>
    <select id="loginRole">
      <option value="patient">üë§ Patient</option>
      <option value="doctor">üë®‚Äç‚öïÔ∏è Doctor</option>
      <option value="admin">üõ† Admin</option>
    </select>
    <button class="primary-btn" type="submit">Login</button>
  </form>
</div>

<!-- Register -->
<div id="registerBox" class="card hidden">
  <h3>Create Account</h3>
  <form id="registerForm">
    <input id="regName" placeholder="üë§ Full Name" required>
    <input id="regEmail" type="email" placeholder="üìß Email" required>
    <input id="regPassword" type="password" placeholder="üîí Password (min 6 chars)" required>
    <select id="regRole">
      <option value="patient">üë§ Patient</option>
      <option value="doctor">üë®‚Äç‚öïÔ∏è Doctor</option>
    </select>
    <button class="primary-btn" type="submit">Sign Up</button>
  </form>
</div>

<!-- Dashboard -->
<div id="dashboard" class="dashboard hidden">
  <h2 id="dashTitle"></h2>
  <div id="dashContent"></div>
</div>

</div>

<script type="module">
/* ================= Firebase ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, doc, setDoc, getDoc, updateDoc,
  collection, addDoc, query, where, getDocs, serverTimestamp, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase config */
const firebaseConfig={
  apiKey:"AIzaSyCGG8qc9y4q8P9p498pWxFNDg4wz_uzjnY",
  authDomain:"muc-hospital.firebaseapp.com",
  projectId:"muc-hospital",
  storageBucket:"muc-hospital.firebasestorage.app",
  messagingSenderId:"613180719346",
  appId:"1:613180719346:web:33ff3d5d633c8d7b49106b"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* ================= UI ================= */
const loginBox=document.getElementById("loginBox");
const registerBox=document.getElementById("registerBox");
const dashboard=document.getElementById("dashboard");
const dashTitle=document.getElementById("dashTitle");
const dashContent=document.getElementById("dashContent");
const navAuth=document.getElementById("navAuth");
const navLogout=document.getElementById("navLogout");

window.showLogin=()=>{loginBox.classList.remove("hidden");registerBox.classList.add("hidden")}
window.showRegister=()=>{registerBox.classList.remove("hidden");loginBox.classList.add("hidden")}

/* ================= Auth State ================= */
onAuthStateChanged(auth, async user=>{
  if(user){
    navAuth.classList.add("hidden");
    navLogout.classList.remove("hidden");

    const snap=await getDoc(doc(db,"users",user.uid));
    if(snap.exists()){
      openDashboard(snap.data().role);
    }
  }else{
    navAuth.classList.remove("hidden");
    navLogout.classList.add("hidden");
    dashboard.classList.add("hidden");
    showLogin();
  }
});

/* ================= Register ================= */
registerForm.onsubmit=async e=>{
  e.preventDefault();
  const u=await createUserWithEmailAndPassword(auth,regEmail.value,regPassword.value);
  await setDoc(doc(db,"users",u.user.uid),{
    name:regName.value,
    email:regEmail.value,
    role:regRole.value,
    status:regRole.value==="doctor"?"pending":"active"
  });
  alert("Account created successfully");
};

/* ================= Login ================= */
loginForm.onsubmit=async e=>{
  e.preventDefault();
  const u=await signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);
  const snap=await getDoc(doc(db,"users",u.user.uid));
  const d=snap.data();

  if(d.role!==loginRole.value) return alert("Wrong role");
  if(d.role==="doctor" && d.status!=="active") return alert("Doctor pending approval");
};

/* ================= Logout ================= */
window.logout=async()=>{
  await signOut(auth);
};

/* ================= Dashboard ================= */
function openDashboard(role){
  loginBox.classList.add("hidden");
  registerBox.classList.add("hidden");
  dashboard.classList.remove("hidden");

  dashTitle.innerText=role.toUpperCase()+" DASHBOARD";

  if(role==="patient"){
    dashContent.innerHTML=`
      <div class="grid">
        <div class="box" onclick="showBooking()">üóìÔ∏è Book Appointment</div>
        <div class="box" onclick="loadMyAppointments()">üìã My Appointments</div>
      </div>
      <div id="bookingArea"></div>
      <div id="appointmentsArea"></div>
    `;
  }

  if(role==="doctor"){
    dashContent.innerHTML=`
      <div class="grid">
        <div class="box" onclick="loadDoctorAppointments()">üë®‚Äç‚öïÔ∏è Pending Appointments</div>
      </div>
      <div id="doctorAppointments"></div>
    `;
  }

  if(role==="admin"){
    dashContent.innerHTML=`
      <div class="grid">
        <div class="box" onclick="loadPendingDoctors()">üë• Approve Doctors</div>
      </div>
      <div id="adminDoctors"></div>
    `;
  }
}

/* ================= Booking ================= */
window.showBooking=()=>{
  bookingArea.innerHTML=`
    <h3>Book Appointment</h3>
    <input type="date" id="date">
    <input type="time" id="time">
    <button class="primary-btn" onclick="confirmBooking()">Confirm</button>
  `;
};

window.confirmBooking=async()=>{
  await addDoc(collection(db,"appointments"),{
    patientId:auth.currentUser.uid,
    date:date.value,
    time:time.value,
    status:"pending",
    createdAt:serverTimestamp()
  });
  alert("Appointment booked");
};

/* ================= Patient ================= */
window.loadMyAppointments=()=>{
  const q=query(collection(db,"appointments"),
    where("patientId","==",auth.currentUser.uid));
  onSnapshot(q,s=>{
    appointmentsArea.innerHTML="<h3>My Appointments</h3>";
    s.forEach(d=>{
      const a=d.data();
      appointmentsArea.innerHTML+=`
        <div class="box">
          ${a.date} - ${a.time}<br>
          <span class="badge ${a.status}">${a.status}</span>
        </div>`;
    });
  });
};

/* ================= Doctor ================= */
window.loadDoctorAppointments=async()=>{
  doctorAppointments.innerHTML="<h3>Pending Appointments</h3>";
  const q=query(collection(db,"appointments"),where("status","==","pending"));
  const s=await getDocs(q);
  s.forEach(d=>{
    const a=d.data();
    doctorAppointments.innerHTML+=`
      <div class="box">
        ${a.date} - ${a.time}<br>
        <button onclick="approveAppointment('${d.id}')">Approve</button>
        <button onclick="rejectAppointment('${d.id}')">Reject</button>
      </div>`;
  });
};

window.approveAppointment=async id=>{
  await updateDoc(doc(db,"appointments",id),{status:"approved"});
  loadDoctorAppointments();
};

window.rejectAppointment=async id=>{
  await updateDoc(doc(db,"appointments",id),{status:"rejected"});
  loadDoctorAppointments();
};

/* ================= Admin ================= */
window.loadPendingDoctors=async()=>{
  adminDoctors.innerHTML="<h3>Pending Doctors</h3>";
  const q=query(collection(db,"users"),
    where("role","==","doctor"),where("status","==","pending"));
  const s=await getDocs(q);
  s.forEach(d=>{
    const u=d.data();
    adminDoctors.innerHTML+=`
      <div class="box">
        ${u.name}<br>${u.email}
        <button onclick="approveDoctor('${d.id}')">Approve</button>
      </div>`;
  });
};

window.approveDoctor=async uid=>{
  await updateDoc(doc(db,"users",uid),{status:"active"});
  loadPendingDoctors();
};
</script>

</body>
</html>

